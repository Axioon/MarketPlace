CREATE DATABASE storage;

CREATE TABLE rol (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(25)
);

INSERT INTO rol (nombre) VALUES ('Administrador');
INSERT INTO rol (nombre) VALUES ('Usuario');
INSERT INTO rol (nombre) VALUES ('Invitado');

CREATE TABLE categoria (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(25)
)
;

INSERT INTO categoria (nombre) VALUES ('hardware');
INSERT INTO categoria (nombre) VALUES ('accesorios');
INSERT INTO categoria (nombre) VALUES ('software');

CREATE TABLE articulo (
    id SERIAL PRIMARY KEY, 
    nombre VARCHAR(100) NOT NULL,
    descripcion VARCHAR(300) NOT NULL,
    categoria_id INT REFERENCES categoria(id),
    precio DECIMAL(10, 2) NOT NULL,
    stock INT NOT NULL,
    img VARCHAR(1000)
);

INSERT INTO articulo (nombre, descripcion, categoria_id, precio, stock, img) VALUES 
    ('Tarjeta Grafica GTX 1080', 'Potente tarjeta grafica para gaming', 1, 499.99, 10, 'https://static.gigabyte.com/StaticFile/Image/Global/10b31e4064d3a7542b989b83b47ab349/Product/18113/png/500'),
    ('Tarjeta Grafica RTX 2080 Ti', 'Alto rendimiento para juegos de ultima generacion', 1, 799.99, 5, 'https://m.media-amazon.com/images/I/8188NNMGDOL._AC_UF894,1000_QL80_.jpg'),
    ('Tarjeta Grafica AMD Radeon RX 6800', 'Tarjeta grafica de gama alta para jugadores exigentes', 1, 649.99, 8, 'https://sipoonline.cl/wp-content/uploads/2023/06/Tarjeta-de-Video-Gigabyte-Radeon-RX-6800-Gaming-OC-16GB-GDDR6-PCIe-4.0.jpg');
INSERT INTO articulo (nombre, descripcion, categoria_id, precio, stock, img) VALUES 
    ('Procesador Intel Core i9-9900K', 'Procesador de alto rendimiento para aplicaciones exigentes', 1, 399.99, 15, 'https://cdn3.spider.cl/14258-large_default/procesador-intel-core-i9-9900k-8-core-16-thread-36ghz-50ghz-turbo-lga1151-v2-95w-sin-fan.jpg'),
    ('Procesador AMD Ryzen 9 5900X', 'Procesador de alto rendimiento para gaming y multitarea', 1, 549.99, 10, 'https://www.amd.com/content/dam/amd/en/images/products/processors/ryzen/2505503-ryzen-9-5900x.jpg'),
    ('Procesador Intel Core i7-10700K', 'Procesador potente para juegos y aplicaciones de productividad', 1, 349.99, 12, 'https://gigaclic.cl/wp-content/uploads/2021/09/intel-core-i7-10700k-380-ghz.jpg');
INSERT INTO articulo (nombre, descripcion, categoria_id, precio, stock, img) VALUES 
    ('Placa Base ASUS ROG Strix Z390-E', 'Placa base de alta gama para entusiastas de PC', 1, 259.99, 20, 'https://media.solotodo.com/media/products/836132_picture_1542614352.png'),
    ('Placa Base MSI B450 TOMAHAWK MAX', 'Placa base solida y confiable para sistemas de nivel medio', 1, 139.99, 25, 'https://asset.msi.com/resize/image/global/product/product_1_20200806161944_5f2bbd20c4441.png62405b38c58fe0f07fcef2367d8a9ba1/600.png'),
    ('Placa Base Gigabyte B550 AORUS ELITE', 'Placa base con soporte para PCIe 4.0 y diseño robusto', 1, 189.99, 18, 'https://www.winpy.cl/files/w21114_b550_aorus_elite_v2_1.jpg');
INSERT INTO articulo (nombre, descripcion, categoria_id, precio, stock, img) VALUES 
    ('Memoria RAM Corsair Vengeance LPX 16GB', 'Memoria RAM DDR4 de alta velocidad', 1, 89.99, 30, 'https://http2.mlstatic.com/D_NQ_NP_796986-MLA48281933778_112021-O.webp'),
    ('Memoria RAM G.SKILL Trident Z RGB 32GB', 'Memoria RAM DDR4 de alta capacidad con iluminacion RGB', 1, 169.99, 15, 'https://media.spdigital.cl/thumbnails/products/1rzkz57j_4c473a83_thumbnail_512.jpg'),
    ('Memoria RAM HyperX Fury 8GB', 'Memoria RAM DDR4 confiable y economica', 1, 49.99, 20, 'https://dojiw2m9tvv09.cloudfront.net/16157/product/hx426c16fb388168.jpg');
INSERT INTO articulo (nombre, descripcion, categoria_id, precio, stock, img) VALUES 
    ('Disco Duro SSD Samsung 970 EVO 1TB', 'Almacenamiento SSD de alta velocidad y capacidad', 1, 179.99, 25, 'https://media.spdigital.cl/thumbnails/products/tmp5cholg2c_916514d9_thumbnail_4096.jpg'),
    ('Disco Duro SSD Crucial MX500 500GB', 'Disco SSD confiable y de alto rendimiento', 1, 89.99, 20, 'https://http2.mlstatic.com/D_NQ_NP_607768-MLU75918045896_042024-O.webp'),
    ('Disco Duro SSD Western Digital Blue 1TB', 'Almacenamiento SSD rapido y duradero', 1, 99.99, 30, 'https://falabella.scene7.com/is/image/Falabella/gsc_115252251_1058557_1?wid=800&hei=800&qlt=70');
INSERT INTO articulo (nombre, descripcion, categoria_id, precio, stock, img) VALUES 
    ('Gabinete NZXT H510', 'Gabinete moderno y elegante para tu PC', 1, 99.99, 40, 'https://media.spdigital.cl/thumbnails/products/6xl7evup_7b40e13b_thumbnail_512.jpg'),
    ('Gabinete Corsair Crystal 570X RGB', 'Gabinete con paneles de vidrio templado y efectos de iluminacion RGB', 1, 199.99, 12, 'https://http2.mlstatic.com/D_NQ_NP_899966-MLC44738715560_012021-O.webp'),
    ('Gabinete Cooler Master MasterBox Q300L', 'Diseno compacto y versatil para construcciones de PC', 1, 59.99, 35, 'https://centrale.cl/wp-content/uploads/Cooler-Master-Gabinete-Gamer-Masterbox-Q300L-Rainbow-Micro-Atx-Panel-Acrilico.webp');

INSERT INTO articulo (nombre, descripcion, categoria_id, precio, stock, img) 
VALUES ('Logitech G203 Prodigy Mouse Gaming', 'Mouse disenado para jugadores exigentes', 2, 29.99, 20, 'https://falabella.scene7.com/is/image/Falabella/8609163_4?wid=800&hei=800&qlt=70');
INSERT INTO articulo (nombre, descripcion, categoria_id, precio, stock, img) 
VALUES ('Corsair K70 RGB Teclado Mecanico RGB', 'Teclado mecanico con retroiluminacion RGB personalizable', 2, 79.99, 15, 'https://etchile.net/wp-content/uploads/2023/07/corsair_K70-RGB-TKL-champion-series_04.jpg');
INSERT INTO articulo (nombre, descripcion, categoria_id, precio, stock, img) 
VALUES ('SteelSeries QcK Prism Mousepad Grande', 'Mousepad extra grande para movimientos suaves del raton', 2, 19.99, 30, 'https://media.spdigital.cl/thumbnails/products/tmp4nys8sqv_e5fad185_thumbnail_512.jpg');
INSERT INTO articulo (nombre, descripcion, categoria_id, precio, stock, img) 
VALUES ('Sony WH-1000XM4 Auriculares Inalambricos', 'Auriculares inalambricos con calidad de sonido premium', 2, 99.99, 10, 'https://http2.mlstatic.com/D_NQ_NP_832738-MLA51077928930_082022-O.webp');
INSERT INTO articulo (nombre, descripcion, categoria_id, precio, stock, img) 
VALUES ('Audio-Technica AT2020USB+ Microfono de Condensador', 'Microfono de condensador para grabaciones profesionales', 2, 129.99, 8, 'https://www.fluteservice.cl/wp-content/uploads/2022/03/AT2020.jpg');

INSERT INTO articulo (nombre, descripcion, categoria_id, precio, stock, img) 
VALUES ('Revision de PC', 'Servicio de revision y mantenimiento de PC', 3, 49.99, 15, 'https://pcvgrupo.com/wp-content/uploads/2022/07/Rapara-tu-ordenador-servicio-tecnico_1920-e1657705958239-1920x1080.jpg');
INSERT INTO articulo (nombre, descripcion, categoria_id, precio, stock, img) 
VALUES ('Armado de PC a medida', 'Servicio de armado de PC personalizado segun tus necesidades', 3, 99.99, 10, 'https://cdnx.jumpseller.com/ultimate-gamer-store/image/30899218/resize/540/540?1673708139');




CREATE TABLE usuario (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(25),
    correo_electronico VARCHAR(100),
    contrasena VARCHAR(255),
    direccion VARCHAR(100),
    telefono VARCHAR(15),
    rol_id INT REFERENCES rol(id)
);

INSERT INTO usuario (nombre, correo_electronico, contrasena, direccion, telefono, rol_id) 
VALUES ('Jose Lopez', 'j.lopez@gmail.com', '123', 'Dirección de usuario normal', '987654321', 2);
INSERT INTO usuario (nombre, correo_electronico, contrasena, direccion, telefono, rol_id) 
VALUES ('Admin', 'admin@gmail.com', '321', 'Dirección de administrador', '123123123', 1);

CREATE TABLE detalle_carrito (
    id SERIAL PRIMARY KEY,
    carrito_id INT REFERENCES carrito(id),
    articulo_id INT REFERENCES articulo(id),
    cantidad INT NOT NULL
);

CREATE TABLE pedido (
    id SERIAL PRIMARY KEY,
    carrito_id INT REFERENCES carrito(id),
    articulo_id INT REFERENCES articulo(id),
    usuario_id INT REFERENCES usuario(id),
    cantidad INT NOT NULL,
    precio DECIMAL(10, 2) NOT NULL 
);

CREATE TABLE detalle_pedido (
    id SERIAL PRIMARY KEY, 
    pedido_id INT REFERENCES pedido(id),
    articulo_id INT REFERENCES articulo(id),
    precio_total DECIMAL(10, 2) NOT NULL,
    cantidad_articulos INT NOT NULL
);

CREATE TABLE oferta (
    id SERIAL PRIMARY KEY,
    descuento DECIMAL(5, 2), 
    fecha_inicio DATE,
    fecha_fin DATE
);

INSERT INTO oferta (descuento, fecha_inicio, fecha_fin) VALUES (10.00, '2024-04-01', '2024-04-30');

CREATE TABLE articulo_oferta (
    articulo_id INT REFERENCES articulo(id),
    oferta_id INT REFERENCES oferta(id),
    PRIMARY KEY (articulo_id, oferta_id),
    FOREIGN KEY (articulo_id) REFERENCES articulo(id) ON DELETE CASCADE
);

INSERT INTO articulo_oferta (articulo_id, oferta_id) VALUES (1, 1);

ALTER TABLE detalle_carrito
ADD CONSTRAINT fk_carrito_articulo
FOREIGN KEY (articulo_id) REFERENCES articulo(id)
ON DELETE CASCADE;

ALTER TABLE pedido
ADD CONSTRAINT fk_pedido_articulo
FOREIGN KEY (articulo_id) REFERENCES articulo(id)
ON DELETE CASCADE;

ALTER TABLE detalle_pedido
ADD CONSTRAINT fk_detallepedido_articulo
FOREIGN KEY (articulo_id) REFERENCES articulo(id)
ON DELETE CASCADE;


CREATE TABLE carrito (
    id SERIAL PRIMARY KEY,
    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    estado VARCHAR(10)
);
INSERT INTO carrito (estado) VALUES ('pendiente');

CREATE TABLE articulo_carrito_usuario (
    id SERIAL PRIMARY KEY,
    articulo_id INT REFERENCES articulo(id),
    carrito_id INT REFERENCES carrito(id),
    usuario_id INT REFERENCES usuario(id),
    cantidad INT, -- podrías agregar esta columna si deseas llevar un registro de la cantidad de cada artículo en el carrito
    UNIQUE (articulo_id, carrito_id, usuario_id) -- Esta restricción garantiza que no haya duplicados
);

INSERT INTO articulo_carrito_usuario (articulo_id, carrito_id, usuario_id, cantidad)
VALUES 
    (1, 1, 1, 2), 
    (2, 1, 1, 1); 
